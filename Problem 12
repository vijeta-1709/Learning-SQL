SELECT app_id,

 
 ROUND(100.0 * SUM(CASE WHEN event_type = 'click' THEN 1 ELSE 0 END)/
        NULLIF(SUM(CASE WHEN event_type = 'impression' THEN 1 ELSE 0 END),1
        ),2
        ) AS CTR

FROM events
WHERE EXTRACT (YEAR FROM timestamp) = 2022
GROUP BY app_id;
